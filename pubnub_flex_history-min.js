var pubnub_flex_history=function(e,t){function n(e){return e.toString().length<12?1e7*parseInt(e):parseInt(e)}function r(e,t){e.callback=function(e){t({start:parseInt(e[1]),end:parseInt(e[2]),count:e[0].length,messages:e[0]})},e.error=function(e){t({error:!0,errorObject:e,errorMessage:e.toString()})},a.history(e)}function s(){i.count=e.last-o.count>=100?100:e.last-o.count,r(i,function(n){o.count+=n.count,Array.prototype.push.apply(o.messages,n.messages),(n.start<o.start||0===o.start)&&(o.start=n.start),n.end>o.end&&(o.end=n.end),o.count<e.last?(i.end=n.start,s()):t(o)})}function s(){r(i,function(e){o.count+=e.count,Array.prototype.push.apply(o.messages,e.messages),(e.start<o.start||0===o.start)&&(o.start=e.start),e.end>o.end&&(o.end=e.end),100===e.count?(i.start=e.end,s()):t(o)})}function s(){r(i,function(e){o.count+=e.count,Array.prototype.push.apply(o.messages,e.messages),(e.start<o.start||0===o.start)&&(o.start=e.start),e.end>o.end&&(o.end=e.end),100===e.count?(i.start=e.end,s()):t(o)})}var a=this,o={count:0,start:0,end:0,channel:e.channel,messages:[]};if(o.operation=e.hasOwnProperty("last")?"last":o.operation,o.operation=e.hasOwnProperty("since")?"since":o.operation,o.operation=e.hasOwnProperty("between")?"between":o.operation,o.operation=e.hasOwnProperty("at")?"at":o.operation,o.operation=e.hasOwnProperty("getrange")?"getrange":o.operation,!e.hasOwnProperty("channel"))return console.error("ERROR: pubnub_flex_history requires a channel specified in options object"),o.channel=null,o.error=!0,o.errorMessage="channel not specified",void t(o);var i={channel:e.channel,include_token:!0};if(e.hasOwnProperty("last"))parseInt(e.last)<=100&&(i.count=e.last,r(i,function(e){for(var n in e)o[n]=e[n];t(o)})),parseInt(e.last)>100&&s();else if(e.hasOwnProperty("since"))i.start=n(e.since),i.reverse=!0,s();else if(e.hasOwnProperty("getrange"))i.count=1,o.messages={},r(i,function(e){if(o.messages.last=e.messages[0],e.end>o.end){o.end=e.end;var n=e.end/1e7|0,r=new Date(0);r.setUTCSeconds(n),o.endE=n,o.endD=r.toString()}o.start>0&&o.end>0&&t(o)}),i.reverse=!0,r(i,function(e){if(o.messages.first=e.messages[0],e.start<o.start||0===o.start){o.start=e.start;var n=e.start/1e7|0,r=new Date(0);r.setUTCSeconds(n),o.startE=n,o.startD=r.toString()}o.start>0&&o.end>0&&t(o)});else if(e.hasOwnProperty("between")){var c=n(e.between[0]),p=n(e.between[1]);c>p&&(c=p,p=n(e.between[0])),i.start=c,i.end=p,i.reverse=!0,s()}else e.hasOwnProperty("at")?(i.start=n(e.at)-1,i.count=1,r(i,function(e){o.count+=e.count,Array.prototype.push.apply(o.messages,e.messages),e.count>0&&(e.start<o.start||0===o.start)&&(o.start=e.start),e.count>0&&e.end>o.end&&(o.end=e.end),t(o)})):(console.error("ERROR: pubnub_flex_history operation required, one of [last, since, getrange, between, at]"),o.error=!0,o.errorMessage="operation required, one of [last, since, getrange, between, at]",t(o))};