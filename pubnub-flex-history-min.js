var pubnub_flex_history=function(e,t){function n(e){return e.toString().length<12?1e7*parseInt(e):parseInt(e)}function r(e,t){e.callback=function(e){t({start:parseInt(e[1]),end:parseInt(e[2]),count:e[0].length,messages:e[0]})},e.error=function(e){t({error:!0,errorObject:e,errorMessage:e.toString()})},i.history(e)}function a(){c.count=e.last-u.count>=100?100:e.last-u.count,r(c,function(n){u.count+=n.count,Array.prototype.push.apply(u.messages,n.messages),(n.start<u.start||0===u.start)&&(u.start=n.start),n.end>u.end&&(u.end=n.end),u.count<e.last?(c.end=n.start,a()):t(u)})}function s(){r(c,function(e){u.count+=e.count,Array.prototype.push.apply(u.messages,e.messages),(e.start<u.start||0===u.start)&&(u.start=e.start),e.end>u.end&&(u.end=e.end),100===e.count?(c.start=e.end,s()):t(u)})}function o(){r(c,function(e){u.count+=e.count,Array.prototype.push.apply(u.messages,e.messages),(e.start<u.start||0===u.start)&&(u.start=e.start),e.end>u.end&&(u.end=e.end),100===e.count?(c.start=e.end,o()):t(u)})}function p(){r(c,function(e){u.count+=e.count,Array.prototype.push.apply(u.messages,e.messages),(e.start<u.start||0===u.start)&&(u.start=e.start),e.end>u.end&&(u.end=e.end),100===e.count?(c.start=e.end,p()):t(u)})}function s(){r(c,function(e){u.count+=e.count,Array.prototype.push.apply(u.messages,e.messages),(e.start<u.start||0===u.start)&&(u.start=e.start),e.end>u.end&&(u.end=e.end),100===e.count?(c.start=e.end,s()):t(u)})}var i=this,u={count:0,start:0,end:0,channel:e.channel,messages:[],operation:"undefined",operationValue:"undefined"};if(u.operation=e.hasOwnProperty("last")?"last":u.operation,u.operation=e.hasOwnProperty("since")?"since":u.operation,u.operation=e.hasOwnProperty("upto")?"upto":u.operation,u.operation=e.hasOwnProperty("between")?"between":u.operation,u.operation=e.hasOwnProperty("at")?"at":u.operation,u.operation=e.hasOwnProperty("getrange")?"getrange":u.operation,u.operation=e.hasOwnProperty("getall")?"getall":u.operation,!e.hasOwnProperty("channel"))return console.error("ERROR: pubnub_flex_history requires a channel specified in options object"),u.channel=null,u.error=!0,u.errorMessage="channel not specified",void t(u);var c={channel:e.channel,include_token:!0};if(e.hasOwnProperty("last"))u.operationValue=e.last,parseInt(e.last)<=100&&(c.count=e.last,r(c,function(e){for(var n in e)u[n]=e[n];t(u)})),parseInt(e.last)>100&&a();else if(e.hasOwnProperty("since"))u.operationValue=e.since,c.start=n(e.since),c.reverse=!0,s();else if(e.hasOwnProperty("upto"))u.operationValue=e.upto,c.end=n(e.upto),c.reverse=!0,o();else if(e.hasOwnProperty("getrange"))u.operationValue=!0,u.messages={},c.count=1,r(c,function(e){if(u.messages.last=e.messages[0],e.end>u.end){u.end=e.end;var n=e.end/1e7|0,r=new Date(0);r.setUTCSeconds(n),u.endE=n,u.endD=r.toString()}u.start>0&&u.end>0&&t(u)}),c.reverse=!0,r(c,function(e){if(u.messages.first=e.messages[0],e.start<u.start||0===u.start){u.start=e.start;var n=e.start/1e7|0,r=new Date(0);r.setUTCSeconds(n),u.startE=n,u.startD=r.toString()}u.start>0&&u.end>0&&t(u)});else if(e.hasOwnProperty("between")){u.operationValue=e.between;var l=n(e.between[0]),d=n(e.between[1]);l>d&&(l=d,d=n(e.between[0])),c.start=l,c.end=d,c.reverse=!0,p()}else e.hasOwnProperty("at")?(u.operationValue=e.at,c.start=n(e.at),c.count=1,r(c,function(e){u.count+=e.count,Array.prototype.push.apply(u.messages,e.messages),e.count>0&&(e.start<u.start||0===u.start)&&(u.start=e.start),e.count>0&&e.end>u.end&&(u.end=e.end),t(u)})):e.hasOwnProperty("getall")?(u.operationValue=!0,c.start=n(1262307661),c.reverse=!0,s()):(console.error("ERROR: pubnub_flex_history operation required, one of [last, since, getrange, between, at, getall]"),u.error=!0,u.errorMessage="operation required, one of [last, since, getrange, upto, between, at, getall]",u.errorArgs=e,t(u))};