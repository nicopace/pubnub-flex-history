var pubnub_flex_history=function(e,t){function n(e){return e.toString().length<12?(1e7*parseInt(e)).toString():e.toString()}function r(e,t){if(console.log("lt",e,t),0===e)return!0;if(0===t)return!1;if(e.length===t.length){for(idx in e)if(parseInt(e[idx])<parseInt(t[idx]))return!0;return!1}console.error("timetokens weren't of the same length",e.length,t.length)}function s(e,t){if(console.log("gt",e,t),0===t)return!0;if(0===e)return!1;if(e.length===t.length){for(idx in e)if(parseInt(e[idx])>parseInt(t[idx]))return!0;return!1}console.error("timetokens weren't of the same length",e.length,t.length)}function a(e,t){e.callback=function(e){t({start:e[1],end:e[2],count:e[0].length,messages:e[0]})},e.error=function(e){t({error:!0,errorObject:e,errorMessage:e.toString()})},l.history(e)}function o(){d.count=e.last-c.count>=100?100:e.last-c.count,a(d,function(n){c.count+=n.count,Array.prototype.push.apply(c.messages,n.messages),(0===c.start||r(n.start,c.start))&&(c.start=n.start),s(n.end,c.end)&&(c.end=n.end),c.count<e.last?(d.end=n.start,o()):t(c)})}function i(){a(d,function(e){c.count+=e.count,Array.prototype.push.apply(c.messages,e.messages),(0===c.start||r(e.start,c.start))&&(c.start=e.start),s(e.end,c.end)&&(c.end=e.end),100===e.count?(d.start=e.end,i()):t(c)})}function u(){a(d,function(e){c.count+=e.count,Array.prototype.push.apply(c.messages,e.messages),(0===c.start||r(e.start,c.start))&&(c.start=e.start),s(e.end,c.end)&&(c.end=e.end),100===e.count?(d.start=e.end,u()):t(c)})}function p(){a(d,function(e){c.count+=e.count,Array.prototype.push.apply(c.messages,e.messages),(0===c.start||r(e.start,c.start))&&(c.start=e.start),s(e.end,c.end)&&(c.end=e.end),100===e.count?(d.start=e.end,p()):t(c)})}function i(){a(d,function(e){c.count+=e.count,Array.prototype.push.apply(c.messages,e.messages),(0===c.start||r(e.start,c.start))&&(c.start=e.start),s(e.end,c.end)&&(c.end=e.end),100===e.count?(d.start=e.end,i()):t(c)})}var l=this,c={count:0,start:0,end:0,channel:e.channel,messages:[],operation:"undefined",operationValue:"undefined"};if(c.operation=e.hasOwnProperty("last")?"last":c.operation,c.operation=e.hasOwnProperty("since")?"since":c.operation,c.operation=e.hasOwnProperty("upto")?"upto":c.operation,c.operation=e.hasOwnProperty("between")?"between":c.operation,c.operation=e.hasOwnProperty("at")?"at":c.operation,c.operation=e.hasOwnProperty("getrange")?"getrange":c.operation,c.operation=e.hasOwnProperty("getall")?"getall":c.operation,!e.hasOwnProperty("channel"))return console.error("ERROR: pubnub_flex_history requires a channel specified in options object"),c.channel=null,c.error=!0,c.errorMessage="channel not specified",void t(c);var d={channel:e.channel,include_token:!0};if(e.hasOwnProperty("last"))c.operationValue=e.last,parseInt(e.last)<=100&&(d.count=e.last,a(d,function(e){for(var n in e)c[n]=e[n];t(c)})),parseInt(e.last)>100&&o();else if(e.hasOwnProperty("since"))c.operationValue=e.since,d.start=n(e.since),d.reverse=!0,i();else if(e.hasOwnProperty("upto"))c.operationValue=e.upto,d.end=n(e.upto),d.reverse=!0,u();else if(e.hasOwnProperty("getrange"))c.operationValue=!0,c.messages={},d.count=1,a(d,function(e){if(c.messages.last=e.messages[0],s(e.end,c.end)){c.end=e.end;var n=e.end/1e7|0,r=new Date(0);r.setUTCSeconds(n),c.endE=n,c.endD=r.toString()}s(c.start,0)&&s(c.end,0)&&t(c)}),d.reverse=!0,a(d,function(e){if(c.messages.first=e.messages[0],0===c.start||r(e.start,c.start)){c.start=e.start;var n=e.start/1e7|0,s=new Date(0);s.setUTCSeconds(n),c.startE=n,c.startD=s.toString()}c.start>0&&c.end>0&&t(c)});else if(e.hasOwnProperty("between")){c.operationValue=e.between;var g=n(e.between[0]),f=n(e.between[1]);s(g,f)&&(g=f,f=n(e.between[0])),d.start=g,d.end=f,d.reverse=!0,p()}else e.hasOwnProperty("at")?(c.operationValue=e.at,d.start=n(e.at),d.count=1,a(d,function(e){c.count+=e.count,Array.prototype.push.apply(c.messages,e.messages),e.count>0&&(0===c.start||r(e.start,c.start))&&(c.start=e.start),e.count>0&&s(e.end,c.end)&&(c.end=e.end),t(c)})):e.hasOwnProperty("getall")?(c.operationValue=!0,d.start=n(1262307661),d.reverse=!0,i()):(console.error("ERROR: pubnub_flex_history operation required, one of [last, since, getrange, between, at, getall]"),c.error=!0,c.errorMessage="operation required, one of [last, since, getrange, upto, between, at, getall]",c.errorArgs=e,t(c))};